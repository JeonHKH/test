# :bulb: AI CHAT COMIC PROJECT

[1. ê°œìš”](#1-ê°œ-ìš”)

[2. ë§Œí™”ìƒì„± ê³¼ì •](#2-ë§Œí™”ìƒì„±-ê³¼ì •)<br/>

* [2.1 ìŠ¤í† ë¦¬ ì§œê¸°](#21-ìŠ¤í† ë¦¬-ì§œê¸°)<br/>
+ [2.2 prompt ìƒì„±](#22-prompt-ìƒì„±)
- [2.3 ë§Œí™” Generate](#23-ë§Œí™”-Generate)

[3. ìµœì¢… ê²°ê³¼](#3-ìµœì¢…-ê²°ê³¼ë¬¼)

[4. í™ˆí˜ì´ì§€](#4-í™ˆí˜ì´ì§€)



***
# 1. ê°œìš”
AI ë„¤ì»·ë§Œí™” í”„ë¡œì íŠ¸ëŠ” ìì‹ ì´ ì›í•˜ëŠ” ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ë©´ ê·¸ ì…ë ¥í•œ ë‚´ìš©ì„ í† ëŒ€ë¡œ ê·¸ë¦¼, ë§Œí™”ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ì„œë¹„ìŠ¤ì´ë‹¤.
ë§Œí™”ëŠ” 15ì„¸ê¸°ë¶€í„° ì§€ê¸ˆë‚ ì˜ ì›¹íˆ°ì— ì´ë¥´ê¸°ê¹Œì§€ ë§ì€ ì‚¬ëŒë“¤ì˜ ì‚¬ë‘ì„ ë°›ê³ , ì•ìœ¼ë¡œì˜ ì„±ì¥ ê·œëª¨ë„ í° ì‚°ì—…ì´ë‹¤.
ë‹¤ë§Œ ë§Œí™”ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ë§Œí™”ì˜ êµ¬ì„±ìš”ì†Œì¸ ê·¸ë¦¼ê³¼ ì¤„ê±°ë¦¬ë¥¼ ì˜ ë‹¤ë¤„ì•¼í•˜ì§€ë§Œ ì´ ì§„ì…ì¥ë²½ì´ ë†’ì€í¸ìœ¼ë¡œ,
ì´ í”„ë¡œì íŠ¸ë¡œë¥¼ í†µí•´ í‰ì†Œì— ì¢‹ì€ ìŠ¤í† ë¦¬ê°€ ìˆì–´ë„ ê·¸ë¦¼ì„ ì˜ ê·¸ë¦¬ì§€ëª»í•˜ê±°ë‚˜ ê·¸ë¦¼ì„ ê·¸ë¦¬ê³ ì‹¶ì–´ë„ ê·¸ë¦¼ì„ ë°°ìš°ì§€ ëª»í–ˆë˜ ì‚¬ëŒë“¤ì˜ ë§Œí™”ì œì‘ ì§„ì…ì¥ë²½ì„ ë‚®ì¶°ì¤„ê²ƒì´ë‹¤.


### í”„ë¡œì íŠ¸ ëª©í‘œ  
ê·¸ë¦¼ì„ ì „ë¬¸ì ìœ¼ë¡œ ë°°ìš°ì§€ ì•Šê±°ë‚˜ ë§Œí™” ìŠ¤í† ë¦¬ ì‘ì„±ì— ì–´ë ¤ì›€ì„ ê²ªëŠ” ë§Œí™”ì˜ 'ã…'ìë„ ëª¨ë¥´ëŠ” ì¼ë°˜ì¸ë“¤ë„ ìˆ˜ì¤€ê¸‰ì˜ ë§Œí™”ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.



# 2. ë§Œí™”ìƒì„± ê³¼ì •<br/>
### **ì¤€ë¹„ë¬¼**
* flask ì„œë²„
* fastapi
* openai api key

 
### **2.1 ìŠ¤í† ë¦¬ ì§œê¸°**</br>
open ai apië¥¼ ì´ìš©í•˜ì—¬ chatgptë¥¼ í†µí•´ ìŠ¤í† ë¦¬ë¥¼ ìƒì„±í•  ì˜ˆì •ì…ë‹ˆë‹¤

 <details><summary>
</summary>

  
![11111111111111111111111111111](https://github.com/JeonHKH/test/assets/101096773/17f236ca-7cad-4ddc-b26b-4c7ae0b9e827)


  </details>

   <details><summary>
</summary>

    
![image](https://github.com/JeonHKH/test/assets/101096773/832a385e-4e1d-4c6d-8718-45172d7199b2)


  </details>


ìœ„ ì´ë¯¸ì§€ì²˜ëŸ¼ ì›í•˜ëŠ” í˜•ì‹,ì¥ë¥´ ë“±ì˜ ìŠ¤í† ë¦¬ë¥¼ ë„£ê³  ëŒ€ë‹µí•˜ê¸°ë¥¼ ëˆ„ë¥´ë©´ ë°‘ì˜ ë¹ˆì¹¸ì— chatgptê°€ ëŒ€ë‹µí•œ ë‚´ìš©ì´ ì¶œë ¥ë˜ëŠ” ë°©ì‹ì„ ì±„íƒí•˜ì˜€ìŠµë‹ˆë‹¤.

> êµ¬ë™ì›ë¦¬
>```
>1  chatboot.html ì½”ë“œì¤‘
>2  <div class="input-group mb-3">
>3  <input type="text" class="form-control" placeholder="ì•Œê³ ì‹¶ì€ê±¸ ë§ì”€í•˜ì„¸ìš”" id="txtMsg">
>4  <button class="btn btn-success" type="submit" onclick="Send()" id="btnSend">ëŒ€ë‹µí•˜ê¸°</button></div>
>5  <textarea  id="txtOut"  rows="5" class="form-control" placeholder="ë‹µë³€ì´ ë‚˜íƒ€ë‚˜ëŠ” ê³³ì…ë‹ˆë‹¤"></textarea>
>6   <script src="chat.js" ></script>
>```

##### *chat.js ì½”ë“œì¤‘*

```
1 var OPENAI_API_KEY = "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";
2 
3 function Send(){
4
5  var sQuestion = txtMsg.value;
6  var data = {
7        model: "text-davinci-003",
8        prompt: sQuestion,
9        max_tokens: 2048,
10        temperature: 0
11  }  
12  $.ajax({
13    type: "POST",
14    url: 'https://api.openai.com/v1/completions',
15   headers:{
16        "Accept" : "application/json",
17        "Content-Type": "application/json", 
18        "Authorization": "Bearer " +  OPENAI_API_KEY },
19    data: JSON.stringify(data),
20
21  }).done(function(response) {
22
23       var sanswer = response.choices[0].text
24        txtOut.value = sanswer
25
26  }).fail(function(error) {
27    alert("!/js/user.jsì—ì„œ ì—ëŸ¬ë°œìƒ: " + error.statusText);
28   console.log(error)
29  });
30 }
```

chatboot.htmlì—ì„œ "ì•Œê³ ì‹¶ì€ê±¸ ë§ì”€í•˜ì„¸ìš”" ë¶€ë¶„ì— ìì‹ ì´ ì›í•˜ëŠ” ê²ƒì„ ì…ë ¥í•˜ê³  ëŒ€ë‹µí•˜ê¸°ë¥¼ ëˆ„ë¥´ë©´ chat.jsì—ì„œ ajaxë¥¼ í†µí•´ openai apië¥¼<br/> í˜¸ì¶œí•˜ì—¬ chatgptê°€ ëŒ€ë‹µì„ í•˜ê³  "ë‹µë³€ì´ ë‚˜íƒ€ë‚˜ëŠ” ê³³ì…ë‹ˆë‹¤"ì— í‘œì‹œë©ë‹ˆë‹¤.
<hr>

### **2.2 prompt ìƒì„±**</br>

 <details><summary>
</summary>

  
![image](https://github.com/JeonHKH/test/assets/101096773/f03a21ca-7f2f-4c17-8513-064c582be09f)


</details>


 <details><summary>
</summary>

  
![image](https://github.com/JeonHKH/test/assets/101096773/30857a90-2d14-4ce8-97e1-bdbf1f48dab2)


</details>


flaskë¥¼ ì´ìš©í•˜ì—¬ í™ˆí˜ì´ì§€ì—ì„œ "enter prompt"ì¹¸ì— [1ë‹¨ê³„](#21-ìŠ¤í† ë¦¬-ì§œê¸°)
ì—ì„œ ìƒì„±í•œ ìŠ¤í† ë¦¬ë¥¼ ë„£ê³  "generate"ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ stablediffusionìš© promptë¡œ ë°”ë€Œì–´ ì¶œë ¥ì´ëœë‹¤.<br/>



#### ğŸ›  êµ¬ë™ì›ë¦¬      
<br/>



**2.2.1 flaskë¥¼ ì±„íƒí•œ ì´ìœ **

1.htmlì—ì„œëŠ” pyhtoníŒŒì¼ì— jsíŒŒì¼ì²˜ëŸ¼ ì§ì ‘ì ìœ¼ë¡œ ì ‘ê·¼í•  ìˆœ ì—†ë‹¤<br/>
2. GPT2Tokenizer, GPT2LMHeadModel importí•˜ë ¤ê³  jsì—ì„œ ë…¸ë ¥í–ˆì§€ë§Œ jsì—ì„œëŠ” ì•„ì§ ê°œë°œì´ ë˜ì§€ ì•Šì•„ ì € ë‘˜ì„ ë°›ì„ ìˆ˜ ì¡°ì°¨ ì—†ë‹¤<br/>
3.from flask_cors import CORS flaskì—ì„œëŠ” nodeì™€ ë‹¬ë¦¬ ì €ëŸ° ê°„ë‹¨í•œ ì½”ë“œ í•˜ë‚˜ë©´ cors errorì—ì„œ ë²—ì–´ë‚  ìˆ˜ ìˆë‹¤

**2.2.2 êµ¬ë™ ì½”ë“œ**
```
1 apppp.py
2 
3 from flask import Flask, request, jsonify
4 from flask_cors import CORS
5 from transformers import GPT2Tokenizer, GPT2LMHeadModel
6 
7 app = Flask(__name__)
8 CORS(app)
9 tokenizer = GPT2Tokenizer.from_pretrained('distilgpt2')
10 model = GPT2LMHeadModel.from_pretrained('FredZhang7/distilgpt2-stable-diffusion-v2')
11
12 @app.route('/generate_text', methods=['POST'])
13 def generate_text():
14     prompt = request.json['prompt']
15     input_ids = tokenizer(prompt, return_tensors='pt').input_ids
16     output = model.generate(input_ids, do_sample=True, max_length=80, num_return_sequences=5)
17 
18    generated_text = [tokenizer.decode(seq, skip_special_tokens=True) for seq in output]
19    return jsonify({'generated_text': generated_text})
20
21 if __name__ == '__main__':
22     app.run(debug=True)
```

##### *casc.html ì½”ë“œ ì¤‘*
```
1   <div class="">
2
3    <input type="text" id="promptInput" placeholder="Enter prompt...">
4    <button onclick="generateText()">Generate</button>
5    <div id="output">
6   </div>
7
8 </div>
9     <script>
10         async function generateText() {
11             const prompt = document.getElementById('promptInput').value;
12             const response = await fetch('http://localhost:5000/generate_text', {
13                 method: 'POST',
14                 headers: {
15                     'Content-Type': 'application/json'
16                 },
17                 body: JSON.stringify({ prompt: prompt })
18             });
19             const data = await response.json();
20             const outputDiv = document.getElementById('output');
21             outputDiv.innerHTML = '';
22             data.generated_text.forEach(text => {
23                 const p = document.createElement('p');
24                 p.textContent = text;
25                 outputDiv.appendChild(p);
26             });
27        }
28        
29     </script>
```
promptì— ì…ë ¥ê°’ì„ ì…ë ¥ í›„ generateë¥¼ í•˜ë©´ flaskë¥¼ í†µí•´ ê°œì„¤ëœ ì„œë²„ì¸ http://127.0.0.1:5000ì— í˜¸ì¶œì´ ê°„ ë’¤ ì„œë²„ì— pretrainedëœ ëª¨ë¸ì—ì„œ stable diffusionìš© promptë¡œ ë³€í™˜ë˜ì–´ ë‚˜ì˜¨ í›„ fetchë¥¼ í†µí•´ ë°›ì•„ì˜¤ëŠ” í˜•ì‹ì´ë‹¤

---

### **2.3 ë§Œí™” Generate**</br>


 <details><summary>
</summary>
<br>
![image](https://github.com/JeonHKH/test/assets/101096773/65e9b0e4-777b-44c3-885a-7a9b527cb6f4)

</details>

 <details><summary>
</summary>

![image](https://github.com/JeonHKH/test/assets/101096773/753c87a3-d647-4d4b-ad70-29b56dc79b4a)

</details>

prompt ì…ë ¥ ì¹¸ì— [2ë‹¨ê³„](#22-prompt-ìƒì„±)ì—ì„œ ìƒì„±í•œ promptë¥¼ ë„£ê³  generate ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì´ë¯¸ì§€ê°€ ìƒì„±ë˜ì–´ ë‚˜ì˜¨ë‹¤.

**2.3.1 prompt ê´€ë ¨ íŒ**

1. ê° promptë¥¼ ì…ë ¥ì‹œ ê¸¸ì´ê°€ ë„ˆë¬´ ê¸¸ì§€ ì•ŠëŠ”ê²Œ ì¢‹ë‹¤
ex) going down the mountain -> mountain, goes down
2. promptë¥¼ ì…ë ¥í–ˆì„ ë•Œ ê²°ê³¼ê°’ì´ ë§Œì¡±í•˜ì§€ ì•Šìœ¼ë©´ prompt ì…ë ¥ ìˆœì„œë§Œ ë‹¬ë¼ì ¸ë„ ê²°ê³¼ ê°’ì´ ë‹¬ë¼ì§€ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆë‹¤.
3.  ë§Œì•½ promptì— ëŒ€í•´ ì•„ì˜ˆ ëª¨ë¥¸ë‹¤ë©´ https://civitai.comì— ë“¤ì–´ê°€ ìì‹ ì´ ì‚¬ìš©í•˜ëŠ” ëª¨ë¸ì„ ê²€ìƒ‰í•˜ì—¬ ê°€ì¥ ë‚˜ì˜¨ ê²ƒ ê°™ì€ ì‚¬ì§„ì˜ promptë¥¼ ë³€í˜•í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ë‹¤.
![image](https://github.com/JeonHKH/test/assets/101096773/5a60295c-09b0-45b4-8ae9-74853af0f189)

### **2.3.2 ì‚¬ìš©í•œ api**

#### 2.3.2(1) api ì‹œí–‰ ì°©ì˜¤
https://stablediffusionapi.comì—ì„œ ì œê³µí•œ apiì‚¬ìš©í•˜ì—¬ í™ˆí˜ì´ì§€ë¥¼ ë§Œë“¤ì—ˆë‹¤
  
![image](https://github.com/JeonHKH/test/assets/101096773/b7a125e6-bb2f-4978-b67e-ef16d5598e53)




ê·¸ë¬ë”ë‹ˆ corì—ëŸ¬ê°€ ë–´ë‹¤. ê·¸ë˜ì„œ nodejsë¥¼ ì´ìš©í•˜ì—¬ ë¡œì»¬ì„œë²„ë¥¼ ë§Œë“¤ì–´ë„ ë³´ê³  í”„ë¡ì‹œ ì„œë²„ë„ ì‚¬ìš©í•´ë³´ê³  í–ˆì§€ë§Œ í•´ê²°ì´ ë¶ˆê°€ëŠ¥ í–ˆë‹¤.

ì´ ë¬¸ì œëŠ” ë‹¤ë¥¸ apië¥¼ ì‚¬ìš©ë•Œë„ í•­ìƒ ë°œìƒí–ˆë‹¤.
ex)![image](https://github.com/JeonHKH/test/assets/101096773/34cc31aa-11e8-4990-9893-de0a271b1c79)


ê·¸ë˜ì„œ finetuningì„ í†µí•´ ëª¨ë¸ì„ ë§Œë“¤ì–´ apië¥¼ ë§Œë“¤ë ¤ê³  í–ˆì§€ë§Œ ëª¨ë¸ì˜ ê²°ê³¼ë¬¼ì´ ë§ˆìŒì— ë“¤ì§€ ì•Šì•˜ë‹¤.

trainingìš© ì‚¬ì§„
![image](https://github.com/JeonHKH/test/assets/101096773/2a7df6fe-4329-4b87-9afd-ed604a937af9)


ê²°ê³¼ë¬¼
ex) ![image](https://github.com/JeonHKH/test/assets/101096773/59b5a7a3-ca0c-4c19-b309-d972b6fbbc2e)


#### 2.3.2(2) ì •ì°©

ë§ì€ ì‹œí–‰ ì°©ì˜¤ë¥¼ ê±°ì³ ë‚˜ì˜¨ ê²ƒì´ Stablediffusion webuiì˜€ë‹¤.

 <details><summary>
</summary>


![image](https://github.com/JeonHKH/test/assets/101096773/45370575-c1be-4d4e-abf6-794179ff0b89)

</details>
sdui ëª¨ë¸ í´ë”ì— ë¯¸ë¦¬ ëª¨ë¸ì„ ë„£ì–´ ë†“ìœ¼ë©´ ì™¼ìª½ìœ„ì—ì„œ ë³€ê²½í•˜ì—¬ checkpointë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤
ë” ë†’ì€ í€„ë¦¬í‹°ë¥¼ ìƒì„±í•˜ê¸°ìœ„í•´ì„œëŠ” loraê°™ì€ ëª¨ë¸ì„ ì‚¬ìš©í•˜ê¸°ë„í•œë‹¤.

fastapië¥¼ ì´ìš©í•´ apië¥¼ ë§Œë“¤ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì±„íƒí–ˆë‹¤

 <details><summary>
</summary>

  
![image](https://github.com/JeonHKH/test/assets/101096773/30ce198b-0872-4fa6-84bd-878058c0ad08)

</details>

ë¬¼ë¡  stablediffusion webuië„ cor errorì— ê±¸ë ¸ì§€ë§Œ webui.batì— set COMMANDLINE_ARGS=--api --cors-allow-origins * ì»¤ë§¨ë“œë¼ì¸ì„ ì¶”ê°€í•´ì„œ cor errorë¥¼ í”¼í• ìˆ˜ ìˆì—ˆë‹¤.

### 2.3.3 ì´ë¯¸ì§€ ì‹œí–‰ ì°©ì˜¤

 <details><summary>
</summary>

![dddadad](https://github.com/JeonHKH/test/assets/101096773/6237258b-3ffd-41a9-93f2-225deb526c4a)  


</details>

promptë¥¼ ìì„¸í•˜ê²Œ ë„£ì§€ ì•Šê±°ë‚˜ negativw promptë¥¼ ì˜ ì¡ê³  ì‹œì‘í•˜ì§€ ì•Šìœ¼ë©´ ì´ëŸ° ì´ë¯¸ì§€ê°€ ë‚˜ì˜¤ê²Œ ëœë‹¤
**2.3.4 êµ¬ë™ì›ë¦¬** 
~~~
1  <script>
2       async function generateImage(imageNumber) {
3         const promptId = 'prompt' + imageNumber;
4         const imageId = 'image' + imageNumber;
5   
6         const promptText = document.getElementById(promptId).value;
7         if (!promptText) {
8           alert('Please enter a prompt!');
9           return;
10        }
11  
12         const url = 'http://127.0.0.1:7860/sdapi/v1/txt2img';
13         const payload = {
14           prompt: promptText,
15           negative_prompt: "(fat, obese, overweight), (worst quality:1.2), (low quality:1.2), easynegative, (jpeg artifact), watermark, font, text, watermark, username, patreon username, patreon logo, censored, bar censor, (wrinkled, grandma, granny), ((books)), ((painting, mirror))",
16           seed: 564404008,  
17           cfg_scale: 6,
18           sampler_index: 'DPM++ 2M Karras',
19           steps: 30
20         };
21  
22         try {
23           const response = await fetch(url, {
24             method: 'POST',
25             headers: {
26               'Content-Type': 'application/json'
27             },
28             body: JSON.stringify(payload)
29           });
30   
31           if (!response.ok) {
32             throw new Error('Error generating image');
33           }
34   
35           const responseData = await response.json();
36           const imageData = responseData.images[0];
37           const imageBlob = base64ToBlob(imageData, 'image/png');
38   
39           const imageUrl = URL.createObjectURL(imageBlob);
40           document.getElementById(imageId).src = imageUrl;
41           console.log(`Image ${imageNumber} generated`);
42         } catch (error) {
43          console.error('Error:', error.message);
44         }
45       }
46   
47       function base64ToBlob(base64Data, contentType) {
48         const sliceSize = 1024;
49         const byteCharacters = atob(base64Data);
50         const byteArrays = [];
51   
52         for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
53           const slice = byteCharacters.slice(offset, offset + sliceSize);
54   
55           const byteNumbers = new Array(slice.length);
56           for (let i = 0; i < slice.length; i++) {
57             byteNumbers[i] = slice.charCodeAt(i);
58           }
59   
60           const byteArray = new Uint8Array(byteNumbers);
61           byteArrays.push(byteArray);
62         }
63   
64         return new Blob(byteArrays, { type: contentType });
65       }
66    </script>
~~~
ìœ„ì—  payloadì•ˆì— promptë¥¼ ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ ìŠ¤ì¼€ì¼ëŸ¬ë‚˜ ì‹œë“œ ë“±ë“±ì„ ë³€ê²½í•˜ì—¬ ì´ë¯¸ì§€ì˜ í€„ë¦¬í‹°ë¥¼ ë†’ì¼ ìˆ˜ ìˆë‹¤.


í™ˆí˜ì´ì§€ì—ì„œ generate ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê·¸ê²Œ ì œê°€ ë§Œë“  ì„œë²„ì¸ http://127.0.0.1:7860ë¡œ ìš”ì²­ì´ ë“¤ì–´ê°€ ì´ë¯¸ì§€ê°€ ìƒì„±ì´ ëœí›„ fetchë¡œ ì´ë¯¸ì§€ê°€ ì˜¤ëŠ” ë°©ì‹ì´ë‹¤
<br/>
+etc) ![image](https://github.com/JeonHKH/test/assets/101096773/eda52b1e-bbc3-4d97-9d80-adcaadaf6453)
ìì‹ ì˜ ì´ë¯¸ì§€ê°€ ì–¼ë§ˆë‚˜ ìƒì„±ëëŠ”ì§€ ë³¼ìˆ˜ ìˆë‹¤.






****************************************************************************************************************************************************************************************************************

# 3. ìµœì¢… ê²°ê³¼ë¬¼<br/>
**3.1 ì¶œë ¥í™”ë©´**<br/>
![image](https://github.com/JeonHKH/test/assets/101096773/925980a6-af6c-48a4-89ae-b5538e01163c)




********************************************************************************************************************************************************************

# 4. í™ˆí˜ì´ì§€ 

![image](https://github.com/JeonHKH/test/assets/101096773/e11a4bb7-86be-4b2a-9daa-9903588da3a2)
![image](https://github.com/JeonHKH/test/assets/101096773/f03a21ca-7f2f-4c17-8513-064c582be09f)   
![image](https://github.com/JeonHKH/test/assets/101096773/053db610-d7de-40f5-8730-038ead5a5ebf)
next ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë°”ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°ˆìˆ˜ ìˆë‹¤.
      
